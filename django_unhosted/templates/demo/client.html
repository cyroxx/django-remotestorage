{% extends "layout.html" %}

{% block license %}<!--
{% include "demo/LICENSE.unhosted" %}-->
{% endblock %}

{% block title %}Sample remoteStorage client{% endblock %}

{% block style_ext %}
.hidden-for-js { display: none; }
.well-shallow { padding: 9px; }
.well-corner { position: absolute; top: 0; right: 0; }
{% endblock %}


{% block head_ext %}
	<script type="text/javascript" src="{{ url_res_jquery }}"></script>
	<script type="text/javascript" src="{{ url_res_remotestorage }}"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}django_unhosted_client/helper.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}django_unhosted_client/tutorial.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}django_unhosted_client/app.js"></script>
{% endblock %}

{% block content_generic %}

<section id="intro">
	<p>
		This is a
		sample <a href="https://github.com/unhosted/remoteStorage.js">remoteStorage.js</a>
		client for retrieving and storing data on a remoteStorage-compatible host.
	</p>
</section>

<section id="connection">
	<div class="well well-shallow form-inline">
		<div class="well-corner" id="states">
			<span id="connectionState">disconnected</span> |
			<span id="authorizedState">not authorized</span>
		</div>
		<div class="control-group">
			<label class="control-label" for="userAddress">Your user address</label>
			<div class="controls"><div class="input-append">
				{% spaceless %}
				<input type="text" id="userAddress" placeholder="test@localhost" />
				<button type="submit" class="btn"
					id="connect">Connect to remoteStorage</button>
				<button type="submit" class="btn hidden-for-js"
					id="disconnect">Disconnect</button>
				<button type="submit" class="btn"
					id="authorize">Authorize access</button>
				<button type="submit" class="btn hidden-for-js"
					id="deauthorize">Deauthorize access</button>
				{% endspaceless %}
			</div></div>
			<img class="hidden-for-js" id="connectionSpinner"
				src="{{ STATIC_URL }}django_unhosted_client/spinner.gif" />
		</div>
	</div>
</section>

<section class="well well-shallow form-inline" id="public_storage">
	<h2 id="publicTitle">Read access for "public" category</h2>
	<div class="control-group">
		<label class="control-label" for="publicKey">Key</label>
		<div class="controls"><div class="input-append">
			{% spaceless %}
			<input type="text" id="publicKey" value="foo" />
			<button type="submit" class="btn"
				id="fetchPublicKey">Fetch</button>
			{% endspaceless %}
		</div></div>
		<img src="{{ STATIC_URL }}django_unhosted_client/spinner.gif"
			id="fetchPublicSpinner" class="hidden-for-js" />

		<label class="control-label" for="publicValue">Value</label>
		<div class="controls"><div class="input-append">
			{% spaceless %}
			<input type="text" id="publicValue" />
			<button type="submit" class="btn"
				id="publishPublic">Save</button>
			{% endspaceless %}
			<img src="{{ STATIC_URL }}django_unhosted_client/spinner.gif"
				id="publishPublicSpinner" class="hidden-for-js" />
		</div></div>
	</div>
</section>

<section class="well well-shallow form-inline" id="private_storage">
	<h2>Read/write access for "tutorial" category</h2>
	<div class="control-group">
		<label class="control-label" for="tutorialKey">Key</label>
		<div class="controls"><div class="input-append">
			{% spaceless %}
			<input type="text" id="tutorialKey" value="bar" />
			<button type="submit" class="btn"
				id="fetchTutorialKey">Fetch</button>
			{% endspaceless %}
		</div></div>
		<img src="{{ STATIC_URL }}django_unhosted_client/spinner.gif"
			id="fetchTutorialSpinner" class="hidden-for-js" />

		<label class="control-label" for="tutorialValue">Value</label>
		<div class="controls"><div class="input-append">
			{% spaceless %}
			<input type="text" id="tutorialValue" />
			<button type="submit" class="btn"
				id="publishTutorial">Save</button>
			{% endspaceless %}
			<img src="{{ STATIC_URL }}django_unhosted_client/spinner.gif"
				id="publishTutorialSpinner" class="hidden-for-js" />
		</div></div>
	</div>
</section>

{% endblock %}


{% comment %}
{% block content %}

<h1>Sample remoteStorage client</h1>

<div class="content_container">
	<p>This is example javascript client to test whether
		storage (and authorization) to a local remoteStorage works.</p>

	{% if not request.user.is_authenticated %}

	<p>Start by <a href="{% url account:signup %}">creating a user</a>.
		Note that remoteStorage client should work even when you're
			not logged in (what's the point of it otherwise?).</p>

	{% else %}

	<a href="">Click here</a> to access remoteStorage (as ...?).</p>

	<p>The following data is available to
		authorized clients at the specified endpoint URI:</p>
	<dl>
		{% url api:storage acct=request.user as url_api %}
		<dt><a href="{{ url_api }}">{{ url_api }}</a></dt>
		<dd>remoteStorage node</dd>
	</dl>

	{% if clients %}
	<p>Authorize the clients at the various scopes:</p>
	<table class="data">
			<tr>
				<th>Name</th>
				<th>date_joined</th>
				<th>last_login</th>
				<th><em>No scope</em></th>
			</tr>
		{% for client in clients %}
			<tr>
				<td><a href="/client/{{ client.key }}">{{ client.name }}</a></td>
				<td>
					<form method="get" action="oauth2/authorize">
						<input type="hidden" name="redirect_uri" value="http://127.0.0.1:8000/client/{{client.key}}/" />
						<input type="hidden" name="response_type" value="code" />
						<input type="hidden" name="client_id" value="{{client.key}}" />
						<input type="hidden" name="scope" value="date_joined" />
						<input type="submit" value="Request" />
					</form>
				</td>
				<td>
					<form method="get" action="oauth2/authorize">
						<input type="hidden" name="redirect_uri" value="http://127.0.0.1:8000/client/{{client.key}}/" />
						<input type="hidden" name="response_type" value="code" />
						<input type="hidden" name="client_id" value="{{client.key}}" />
						<input type="hidden" name="scope" value="last_login" />
						<input type="submit" value="Request" />
					</form>
				</td>
				<td>
					<form method="get" action="oauth2/authorize">
						<input type="hidden" name="redirect_uri" value="http://127.0.0.1:8000/client/{{client.key}}/" />
						<input type="hidden" name="response_type" value="code" />
						<input type="hidden" name="client_id" value="{{client.key}}" />
						<input type="submit" value="Request" />
					</form>
				</td>
			</tr>
		{% endfor %}
	</table>
	{% else %}
	<p>No authorized clients so far.</p>
	{% endif %}

	{% if access_tokens %}
	<p>You have issued the following access tokens.
		Follow the links to see access your data using their credentials.</p>
	<table class="data">
			<tr>
				<th>Client name</th>
				<th>Scope</th>
				<th>date_joined</th>
				<th>last_login</th>
				<th><em>No scope</em></th>
			</tr>
		{% for access_token in access_tokens %}
			<tr>
				<td><a href="/client/{{ access_token.client.key }}">{{ access_token.client.name }}</a></td>
				<td>
					{% if access_token.scope.all|length == 0 %}
						<em>No scope</em>
					{% endif %}
					{% for access_range in access_token.scope.all %}
						{{ access_range.key }}
					{% endfor %}
				</td>
				<td><a href="/api/date_joined" class="authenticate"
					id="_{{access_token.token}}">/api/date_joined</a></td>
				<td><a href="/api/last_login" class="authenticate"
					id="_{{access_token.token}}">/api/last_login</a></td>
				<td><a href="/api/email" class="authenticate"
					id="_{{access_token.token}}">/api/email</a></td>
			</tr>
		{% endfor %}
	</table>
	{% else %}
	<p>You have no access_tokens. Authorize a client to create one.</p>
	{% endif %}

	{% endif %} {# Auth #}
</div>

{% endblock %}
{% endcomment %}
